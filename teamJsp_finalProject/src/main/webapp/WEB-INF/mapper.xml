<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  

  <mapper namespace="kr.co.finalp">
  	<select id="photoGallery_selectAll" parameterType="gallStartEnd" resultType="gdto">	
		SELECT t2.*
		   FROM (
		      SELECT ROWNUM AS rnum
		          , t1.*
		         FROM (
		            SELECT c1.gallery_category_no 								-- 갤러리 카테고리 번호         
		               , c1.gallery_category 									-- 갤러리 카테고리
		               , c2.galleryno 											-- 갤러리 번호 
		               , c2.admin_no  											-- 관리자 번호 
		               , c2.gallery_title 										-- 갤러리 제목
		               , to_char(c2.gallery_date,'yyyy-mm-dd') as gallery_date  -- 갤러리 작성일
		               , c2.gallery_hit 										-- 갤러리 조회수
		               , c3.fileno 												-- 첨부파일 
		               , c3.file_url 											-- 첨부파일 URL
		               FROM gallery_category c1
		               LEFT JOIN gallery c2
		               ON ( c2.gallery_category_no = c1.gallery_category_no )
		               LEFT JOIN files c3
		               ON ( c3.galleryno = c2.galleryno )
		               WHERE 1=1
		               AND c1.gallery_category_no = #{galleryCategoryNo}
		               <choose>		
		               	<when test="sort_order != null and sort_order != '' and sort_order.equals('latest_order')">
			               ORDER BY c2.galleryno desc
		               	</when>	                      
		               	<when test="sort_order != null and sort_order != '' and sort_order.equals('old_order')">
			               ORDER BY c2.galleryno asc
		               	</when>
		               	<otherwise>
		             	   ORDER BY c2.galleryno desc
		               	</otherwise>
		               </choose>
		         ) t1
	             WHERE ROWNUM &lt; = #{endNo}		            
		    ) t2
		    WHERE #{startNo} &lt; = rnum
		    ORDER BY rnum    
  	</select>
  	
  	<select id="photoGallery_getTotal" parameterType="gallStartEnd" resultType="int">
  		SELECT COUNT(*) total
            FROM gallery_category c1
            LEFT JOIN gallery c2
            ON ( c2.gallery_category_no = c1.gallery_category_no )
            LEFT JOIN files c3
            ON ( c3.galleryno = c2.galleryno )
            WHERE c1.gallery_category_no = #{galleryCategoryNo}
  	</select>
  	

  	<select id="photoGallery_selectOne" resultType="gdto" parameterType="int">
  		SELECT t2.*
		   FROM (
		      SELECT ROWNUM AS rnum
		          , t1.*
		         FROM (
		            SELECT c1.gallery_category_no 								-- 갤러리 카테고리 번호         
		               , c1.gallery_category 									-- 갤러리 카테고리
		               , c2.galleryno 											-- 갤러리 번호 
		               , c2.admin_no  											-- 관리자 번호 
		               , c2.gallery_title 										-- 갤러리 제목
		               , to_char(c2.gallery_date,'yyyy-mm-dd') as gallery_date  -- 갤러리 작성일
		               , c2.gallery_hit 										-- 갤러리 조회수
		               , c3.fileno 												-- 첨부파일 
		               , c3.file_url 											-- 첨부파일 URL
		               FROM gallery_category c1
		               LEFT JOIN gallery c2
		               ON ( c2.gallery_category_no = c1.gallery_category_no )
		               LEFT JOIN files c3
		               ON ( c3.galleryno = c2.galleryno )
		         ) t1
		            WHERE galleryno = #{galleryno}
		    ) t2 
  	</select>
  	
  	<update id="gallery_hits" parameterType="int">
  		UPDATE gallery
  		SET gallery_hit = gallery_hit+1
  		WHERE galleryno = #{galleryno}
  	</update>
  	
  	
  	
  	<!-- 공지사항 게시물 하나 선택  -->
  	<select id="notice_selectOne" parameterType="int" resultType="ndto">
 		SELECT noticeno, notice_title, notice_contents, to_char(notice_date, 'YYYY/MM/DD HH24:MI') notice_date, notice_hit 
 		FROM notice
 		WHERE noticeno =#{noticeno}
 	</select>
 	
 	
 	<!-- 공지사항 전체선택  -->
 	<select id="notice_selectAll" parameterType="se" resultType="ndto">
 		SELECT noticeno, notice_title, notice_contents, notice_date, notice_hit
 		FROM ( SELECT ROWNUM rn, noticeno, notice_title, notice_contents, notice_date, notice_hit  
 			FROM( SELECT noticeno, notice_title, notice_contents, to_char(notice_date, 'YYYY/MM/DD') notice_date, notice_hit
 					FROM notice
 					ORDER BY noticeno desc )
 			WHERE ROWNUM &lt;=#{endNo} )
 		WHERE RN &gt;=#{startNo}
 	</select>
 	
 	<!-- 공지사항 총 게시물 수  -->
 	<select id="notice_getTotal" resultType="int">
 		SELECT COUNT(*) total
 		FROM notice
 	</select>
 	
 	<!-- 공지사항 게시물 작성  -->
 	<insert id="notcie_addOne" parameterType="ndto">
	 	INSERT INTO notice
	 	VALUES (notice_noticeno_seq.nextval, 1 , #{notice_title} , #{notice_contents}, #{notice_date}, #{notice_hit} )
 	</insert>
 	
 	<!-- 공지사항 게시물 수정  -->
 	<update id="notice_updateOne" parameterType="ndto">
 		UPDATE notice
 		SET notice_title = #{notice_title}, notice_contents = #{notice_contents}
 		WHERE notceno = #{noticeno}
 	</update>
 	
 	<!-- 공지사항 게시물 삭제  -->
 	<delete id="notice_deleteOne" parameterType="int">
 		DELETE FROM notice
 		WHERE noticeno = #{noticeno}
 	</delete>
 	
 	<!-- 공지사항 게시판 조회수  -->
 	<update id="notice_raiseHits" parameterType="int">
 		UPDATE notice
 		SET notice_hit = notice_hit+1
 		WHERE noticeno = #{noticeno}
 	</update>
 	
 	<!-- 팬게시판 전체 -->
 	<select id="fan_board_selectAll" parameterType="fbStartEnd" resultType="fbdto">
 		SELECT fanno, fan_title, id, fan_date, fan_hit, fan_hit 
 		FROM ( SELECT ROWNUM rn, fanno, fan_title, id, fan_date, fan_hit, fan_hit ft
 			FROM( SELECT fanno, fan_title, id, to_char(fan_date, 'YYYY/MM/DD') fan_date, fan_hit , fan_hit ft
 					FROM fan_board	
 					<choose>
		            <when test="search_option == 'all' "> <!-- 검색 옵션이 전체일 경우 -->
		                WHERE 
		                   id LIKE '%'||#{keyword}||'%'
		                   OR fan_contents LIKE '%' || #{keyword}||'%'
		                   OR fan_title LIKE '%'||#{keyword}||'%'   
		            </when>
		            <otherwise> <!-- 작성자/제목/내용의 검색조건으로 게시물을 검색하는 경우 -->
		                WHERE ${search_option} LIKE '%'||#{keyword}||'%'
		            </otherwise>
		        </choose>		
 				ORDER BY fanno desc )
 			WHERE ROWNUM &lt;=#{endNo} )
 		WHERE RN &gt;=#{startNo}
 	</select>
 	
 	<!-- 팬게시판 게시물 하나 선택  -->
  	<select id="fan_board_selectOne" parameterType="int" resultType="fbdto">
 		SELECT fanno, fan_title, id, to_char(fan_date, 'YYYY/MM/DD') fan_date, fan_contents, fan_hit 
 		FROM fan_board
 		WHERE fanno =#{fanno}
 	</select>
 	
 	<!-- 팬게시판 게시물 작성  -->
 	<insert id="fan_board_addOne" parameterType="fbdto">
 		INSERT INTO fan_board
 		VALUES (fan_board_fanno_seq.nextval, #{id}, #{fan_title}, sysdate, #{fan_contents} , 0 )
 	</insert>
 	
 	<update id="fan_board_updateOne" parameterType="fbdto">
 		UPDATE fan_board
 		SET fan_title = #{fan_title}, id= #{id}, fan_contents = #{fan_contents}
 		WHERE fanno = #{fanno}
 	</update>
 	
 	<delete id="fan_board_deleteOne" parameterType="int">
 		DELETE FROM fan_board
 		WHERE fanno = #{fanno}
 	</delete>
 	
 	<select id="fan_board_getTotal" resultType="int">
  		SELECT COUNT(*) total
  		FROM fan_board
  	</select>
  	
  	<update id="fan_board_raiseHits" parameterType="int">
 		UPDATE fan_board
 		SET fan_hit  = fan_hit +1
 		WHERE fanno = #{fanno}
 	</update>
  	

 	
 		
 	
</mapper>
